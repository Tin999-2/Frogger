<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frogger - Jungle Crisis</title>
    <style>
        body { 
            background: #222; color: white; font-family: sans-serif; text-align: center; 
            margin: 0; padding: 0; overflow: hidden; position: fixed; width: 100%; height: 100%;
        }
        canvas { 
            background: #111; border: 2px solid #555; display: block; margin: 0 auto; 
            width: 95vw; max-width: 400px; height: auto; touch-action: none;
        }
        #clear-screen {
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); border: 3px solid #f1c40f; padding: 20px; border-radius: 15px; 
            z-index: 10; width: 80%;
        }
    </style>
</head>
<body>

    <h2 id="status">Avoid Snakes & Crabs!</h2>
    <canvas id="game" width="400" height="600"></canvas>

    <div id="clear-screen">
        <h2 style="color: #2ecc71;">Goal Reached!</h2>
        <div style="font-size: 2rem; color: #f1c40f;">Signal</div>
        <button onclick="location.reload()">Replay</button>
    </div>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        const clearScreen = document.getElementById("clear-screen");

        // --- Èü≥Â£∞„Éï„Ç°„Ç§„É´„ÅÆË®≠ÂÆö ---
        const bgm = new Audio('/assets/sounds/frog.mp3'); bgm.loop = true;
        const seJump = new Audio('/assets/sounds/jump.mp3');
        const seCrash = new Audio('/assets/sounds/crash.mp3'); // Ê∞¥Ê≤°„ÉªÊïµË°ùÁ™ÅÂÖ±ÈÄö
        const seGoal = new Audio('/assets/sounds/goal.mp3');

        let audioInitialized = false;
        function initAudio() {
            if (audioInitialized) return;
            // ÂÖ®„Å¶„ÅÆÈü≥Â£∞„Çí‰∏ÄÂ∫¶ÁÑ°Èü≥„ÅßÂÜçÁîü„Åó„Å¶„É≠„ÉÉ„ÇØ„ÇíËß£Èô§„Åô„Çã
            [bgm, seJump, seCrash, seGoal].forEach(sound => {
                sound.play().then(() => {
                    if (sound !== bgm) { sound.pause(); sound.currentTime = 0; }
                }).catch(() => {});
            });
            audioInitialized = true;
        }

        const gridSize = 50;
        let isCleared = false;
        
        // „Éó„É¨„Ç§„É§„ÉºÂàùÊúü‰ΩçÁΩÆ (y=11„Åå‰∏ÄÁï™‰∏ã)
        const player = { x: 4, y: 11, char: "üê∏", vx: 0 };

        // ÈùôÁöÑÈöúÂÆ≥Áâ©Ôºà‰∏≠Ê¥≤„ÅÆ„Åø„Å´ÈÖçÁΩÆÔºâ
        const rocks = [{x: 1, y: 4, icon: "üå≤"}, {x: 4, y: 4, icon: "üß±"}, {x: 6, y: 4, icon: "üå≤"}];

        // Âãï„ÅèÊïµÔºàÊâãÂâç„ÅÆÂ∫É„ÅÑËäùÁîü„Ç®„É™„Ç¢ y=9, 10„ÇíÊ≠©„ÅèÔºâ
        const enemies = [
            {x: 0, y: 10, speed: 1.5, dir: 1, icon: "üêç"},
            {x: 7, y: 9, speed: 2.0, dir: -1, icon: "ü¶Ä"}
        ];

        const lanes = [
            { y: 8, speed: 1.5, dir: -1, logs: [{x:0, w:60}, {x:200, w:60}] },
            { y: 7, speed: 1.0, dir: 1,  logs: [{x:50, w:100}, {x:300, w:100}] },
            { y: 6, speed: 2.0, dir: -1, logs: [{x:100, w:50}, {x:300, w:50}] },
            { y: 5, speed: 1.2, dir: 1,  logs: [{x:0, w:120}, {x:250, w:120}] }
        ];

        function draw() {
            if (isCleared) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. ‰∏ãÂú∞ÔºàÁ©∫„Å®Â∑ùÔºâ
            ctx.fillStyle = "#87CEEB"; ctx.fillRect(0, 0, 400, 200);
            ctx.fillStyle = "#2980b9"; ctx.fillRect(0, 250, 400, 200);

            // 2. ‰∏∏Â§™„ÅÆÊèèÁîª„Å®Âà§ÂÆö
            let onLog = false;
            player.vx = 0;
            lanes.forEach(lane => {
                ctx.fillStyle = "#5d4037";
                lane.logs.forEach(log => {
                    log.x += lane.speed * lane.dir;
                    if (log.x > 400) log.x = -log.w;
                    if (log.x < -log.w) log.x = 400;
                    ctx.beginPath(); ctx.roundRect(log.x, lane.y * gridSize + 5, log.w, 40, 10); ctx.fill();
                    
                    let px = player.x * gridSize + 25;
                    if (player.y === lane.y && px > log.x && px < log.x + log.w) {
                        onLog = true;
                        player.vx = lane.speed * lane.dir;
                    }
                });
            });

            // 3. ËäùÁîü„Ç®„É™„Ç¢Ôºà‰∏∏Â§™„ÅÆ‰∏ä„Å´„Åã„Å∂„Åõ„ÇãÔºâ
            ctx.fillStyle = "#2ecc71";
            ctx.fillRect(0, 450, 400, 150); // ÊâãÂâç„ÅÆËäùÁîü„ÇíÊã°Â§ß (y=9, 10, 11)
            ctx.fillRect(0, 200, 400, 50);  // ‰∏≠Ê¥≤ (y=4)
            ctx.fillRect(0, 0, 400, 50);    // „Ç¥„Éº„É´„Çí1Ë°å(50px)„Å´Á∏ÆÂ∞è (y=0)

            // 4. ÈùôÁöÑÈöúÂÆ≥Áâ©Ôºà‰∏≠Ê¥≤„ÅÆ„ÅøÔºâ
            ctx.font = "35px Arial";
            rocks.forEach(r => ctx.fillText(r.icon, r.x * gridSize + 5, r.y * gridSize + 40));

            // 5. Âãï„ÅèÊïµ„ÅÆÊèèÁîª„Å®Ë°ùÁ™ÅÂà§ÂÆö
            enemies.forEach(en => {
                en.x += (en.speed * en.dir) / 50; // „Çπ„É†„Éº„Ç∫„Å™ÁßªÂãï
                if (en.x > 8) en.x = -1;
                if (en.x < -1) en.x = 8;
                ctx.fillText(en.icon, en.x * gridSize, en.y * gridSize + 40);

                // Êïµ„Å®„ÅÆÂΩì„Åü„ÇäÂà§ÂÆö
                if (player.y === en.y && Math.abs(player.x - en.x) < 0.6) {
                    seCrash.currentTime = 0; seCrash.play().catch(()=>{});
                    resetPlayer();
                }
            });

            // 6. Ê∞¥Ê≤°Âà§ÂÆö
            if (player.y >= 5 && player.y <= 8 && !onLog) {
                seCrash.currentTime = 0; seCrash.play().catch(()=>{});
                resetPlayer();
            }

            // 7. „Éó„É¨„Ç§„É§„ÉºÊèèÁîª„Å®ÁßªÂãïÂá¶ÁêÜ
            if (onLog) {
                player.x += player.vx / gridSize;
                if(player.x < 0) player.x = 0; if(player.x > 7) player.x = 7;
            }
            ctx.fillText(player.char, player.x * gridSize + 5, player.y * gridSize + 40);

            // „Ç¥„Éº„É´Âà§ÂÆö
            if (player.y === 0) {
                isCleared = true;
                seGoal.play().catch(()=>{});
                clearScreen.style.display = "block";
            }
            requestAnimationFrame(draw);
        }

        function resetPlayer() { player.x = 4; player.y = 11; }

        function move(dx, dy) {
            if (isCleared) return;
            initAudio(); // ÊúÄÂàù„ÅÆÊìç‰Ωú„Åß„Ç™„Éº„Éá„Ç£„Ç™„ÇíÂàùÊúüÂåñ

            let nextX = Math.round(player.x + dx);
            let nextY = player.y + dy;

            // Â≤©Ôºà‰∏≠Ê¥≤Ôºâ„ÅÆË°ùÁ™ÅÂà§ÂÆö
            const hitRock = rocks.some(r => r.x === nextX && r.y === nextY);
            if (hitRock) return;

            // ÁØÑÂõ≤Âà∂Èôê
            if (nextX >= 0 && nextX <= 7) player.x = nextX;
            if (nextY >= 0 && nextY <= 11) player.y = nextY;

            seJump.currentTime = 0; seJump.play().catch(()=>{});
        }

        window.addEventListener("keydown", e => {
            if (e.key === "ArrowUp") move(0, -1);
            if (e.key === "ArrowDown") move(0, 1);
            if (e.key === "ArrowLeft") move(-1, 0);
            if (e.key === "ArrowRight") move(1, 0);
        });

        canvas.addEventListener("touchstart", e => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const t = e.touches[0];
            const tx = (t.clientX - rect.left) * (canvas.width / rect.width);
            const ty = (t.clientY - rect.top) * (canvas.height / rect.height);
            const px = player.x * gridSize + 25; const py = player.y * gridSize + 25;
            if (Math.abs(tx - px) > Math.abs(ty - py)) move(tx > px ? 1 : -1, 0);
            else move(0, ty > py ? 1 : -1);
        }, {passive: false});

        draw();
    </script>
</body>
</html>
