<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frogger</title>
    <style>
        /* ç”»é¢å…¨ä½“ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚„ä½™ç™½ã‚’é˜²æ­¢ */
        body { 
            background: #333; color: white; font-family: sans-serif; text-align: center; 
            margin: 0; padding: 0; overflow: hidden; position: fixed; width: 100%; height: 100%;
        }
        h2 { margin: 10px 0 5px; font-size: 1.2rem; }
        .hint { color: #aaa; font-size: 0.8rem; margin-bottom: 5px; }

        /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ç”»é¢å¹…ã«åˆã‚ã›ã¦æ‹¡å¤§ */
        canvas { 
            background: #111; border: 2px solid #555; 
            display: block; margin: 0 auto; 
            width: 95vw; /* ç”»é¢æ¨ªå¹…ã®95%ã«æ‹¡å¤§ */
            max-width: 400px; /* ãƒ‘ã‚½ã‚³ãƒ³ã§ã¯å¤§ãããªã‚Šã™ããªã„ã‚ˆã†ã« */
            height: auto; /* ç¸¦æ¨ªæ¯”ã‚’ç¶­æŒ */
            touch-action: none; /* ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œï¼ˆã‚ºãƒ¼ãƒ ç­‰ï¼‰ã‚’ç„¡åŠ¹åŒ– */
        }

        #clear-screen {
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); border: 3px solid #f1c40f; padding: 20px; border-radius: 15px; 
            z-index: 10; width: 80%;
        }
        .coord { font-size: 1.5rem; color: #f1c40f; font-family: monospace; margin: 15px 0; }
        button { padding: 12px 24px; font-size: 1rem; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Help the frog cross the roads</h2>
    <p class="hint">PC Move : â† â†’ã€€â†‘ â†“<br>
Smartphone Move : Tap top, bottom, left, and right of the frog</p>

    <canvas id="game" width="400" height="500"></canvas>

    <div id="clear-screen">
        <h2 style="color: #2ecc71;">You did it!</h2>
        <p><h1>Keyword :</p>
        <div class="coord">Signal</h1></div>
        <!--
        <button onclick="location.reload()">ãƒªãƒ—ãƒ¬ã‚¤</button>
    </div>
    -->

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        const clearScreen = document.getElementById("clear-screen");

        const gridSize = 50;
        let isCleared = false;

        const player = { x: 4, y: 9, char: "ğŸ¸" };

        const lanes = [
            { y: 8, speed: 0.8, dir: -1, cars: [{x:0}, {x:200}, {x:350}], icon: "ğŸš—" },
            { y: 7, speed: 1.2, dir: 1,  cars: [{x:50}, {x:250}], icon: "ğŸš•" },
            { y: 6, speed: 1.8, dir: -1, cars: [{x:100}, {x:300}], icon: "ğŸï¸" },
            { y: 5, speed: 1.0, dir: 1,  cars: [{x:0}, {x:180}, {x:320}], icon: "ğŸšš" }
        ];

        function draw() {
            if (isCleared) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "#2ecc71"; 
            ctx.fillRect(0, 450, 400, 50); // Start
            ctx.fillRect(0, 0, 400, 250);   // Goal area

            ctx.fillStyle = "#444"; 
            ctx.fillRect(0, 250, 400, 200); // Road

            lanes.forEach(lane => {
                lane.cars.forEach(car => {
                    car.x += lane.speed * lane.dir;
                    if (car.x > 400) car.x = -50;
                    if (car.x < -50) car.x = 400;

                    ctx.font = "35px Arial";
                    ctx.fillText(lane.icon, car.x, lane.y * gridSize + 35);

                    let px = player.x * gridSize;
                    let py = player.y * gridSize;
                    if (py === lane.y * gridSize && car.x < px + 30 && car.x + 40 > px) {
                        resetPlayer();
                    }
                });
            });

            ctx.fillText(player.char, player.x * gridSize + 5, player.y * gridSize + 40);

            if (player.y <= 4) {
                isCleared = true;
                clearScreen.style.display = "block";
            }
            requestAnimationFrame(draw);
        }

        function resetPlayer() {
            player.x = 4;
            player.y = 9;
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
        window.addEventListener("keydown", e => {
            if (isCleared) return;
            if (e.key === "ArrowUp" && player.y > 0) player.y--;
            if (e.key === "ArrowDown" && player.y < 9) player.y++;
            if (e.key === "ArrowLeft" && player.x > 0) player.x--;
            if (e.key === "ArrowRight" && player.x < 7) player.x++;
        });

        // ã‚¿ãƒƒãƒ—æ“ä½œï¼ˆç”»é¢æ‹¡å¤§ã«å¯¾å¿œã—ãŸè¨ˆç®—å¼ã«ä¿®æ­£ï¼‰
        canvas.addEventListener("touchstart", e => {
            if (isCleared) return;
            e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢

            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            
            // ç”»é¢ä¸Šã®è¡¨ç¤ºã‚µã‚¤ã‚ºã¨å®Ÿéš›ã®ã‚²ãƒ¼ãƒ å†…ã‚µã‚¤ã‚ºã®æ¯”ç‡ã‚’è¨ˆç®—
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            // ã‚¿ãƒƒãƒ—ä½ç½®ã‚’ã‚²ãƒ¼ãƒ å†…ã®åº§æ¨™ã«å¤‰æ›
            const tx = (touch.clientX - rect.left) * scaleX;
            const ty = (touch.clientY - rect.top) * scaleY;

            const px = player.x * gridSize + 25;
            const py = player.y * gridSize + 25;

            // ç§»å‹•æ–¹å‘ã®æ±ºå®š
            if (Math.abs(tx - px) > Math.abs(ty - py)) {
                if (tx > px && player.x < 7) player.x++;
                else if (player.x > 0) player.x--;
            } else {
                if (ty > py && player.y < 9) player.y++;
                else if (player.y > 0) player.y--;
            }
        }, {passive: false});

        draw();
    </script>
</body>
</html>
